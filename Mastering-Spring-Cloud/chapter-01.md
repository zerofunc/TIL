# 마이크로서비스 소개
## 마이크로서비스의 장점
- 마이크로서비스의 소스 코드 규모가 상대적으로 작아서 프로젝트에 새로 참여하는 개발자가 이해하기 쉬움
- 코드의 품질 유지가 쉬움
- 복잡한 서브 시스템을 만들지않음
- 선택된 영역에 대해 책임을 짐

## 스프링 프레임워크로 마이크로서비스 만들기
- 스프링 클라우드는 서비스 레지스트리와 컨피규레이션서버, 서킷 브레이커, 클라우드 버스, OAuth2 패턴, API게이트웨이와 같은 마이크로서비스 기반 아키텍처에서 사용되는 모든 검증된 패턴을 구현함

## 클라우드 네이티브 개발
- 마이크로서비스는 본질적으로 클라우드 컴퓨팅 플랫폼과 관련 있음
    - 그러나 새로운 개념은 아님
    - 클라우드 솔루션의 인기를 통해 더 높은 수준으로 진화함 
- 마이크로서비스 클라우드 활용의 장점
    - 사용 중인 다른 프라이빗 클라우드 솔루션보다 확장성과 신뢰성, 낮은 유지보수 비용을 제공
    - 새로운 요구사항을 만족시키기 위한 시간과 비용을 절감
- 모놀리식의 단점
    - 수정과 유지보수가 아주 복잡해짐
    - 새로운 기능과 프레임워크 기술을 적용하는 것이 어려워짐
    - 새로운 아이디어를 적용하고 혁신하는 데 부정적 영향을 미침
- 네이티브 클라우드 애플리케이션이란?
    - 단순히 클라우드로 이전한 프로그램이 아니라 클라우드 환경을 위해 잘 설계된 프로그램
    
## 마이크로서비스 아키텍쳐 배우기
- 게이트웨이는 클라이언트의 모든 요청을 다양한 API 종단점으로 *동적*으로 전달한다.
    - *동적*? 서비스 디스커버리의 목록에 기반함
- API 게이트웨이 역할
    - 특정 서비스 호출 숨김 (외부 클라이언트로부터 숨김)
    - 동적 라우팅
    - 중요한 데이터 추적
    - 요청 메트릭 수집
    - 통계내기 좋음
    - 요청 및 응답 헤더 조작

## 서비스 디스커버리의 필요성 이해하기
- 서비스 디스커버리란?
    - 컴퓨터 네트워크상의 디바이스가 제공하는 디바이스와 서비스를 자동으로 감지하는 서비스
- 모든 서비스는 시작 후 다른 서비스가 접근할 수 있는 하나의 중앙 장소에 자신을 등록함
- 등록키는 전체 시스템에서 유일한 서비스이거나 유일한 식별자여야 함
    - 하나의 키에 같은 서비스의 여러 인스턴스가 등록될 수 있음
- 각 서비스는 특정 디스커버리 서버에 등록된 다른 서비스의 전체 목록을 얻음
- 각 서비스는 등록 목록의 변경사항을 원격 디스커버리에 의해 이전에 수집된 컨피규레이셔을 주기적으로 갱심함으로써 얻음
- 서버 컨피규레이션 기능과 함께 사용
    - key-value 쌍으로 저장하는 방식으로 인기있는 도구(컨설, 주키퍼)
    
## 서비스 간 통신
- 시스템의 신뢰성을 보장하려면 최소 두 개의 인스터를 실행하는 것을 목표로 함
- 같은 서비스의 여러 인스턴스는 들어오는 요청에 대해 부하 분산을 적용해야 함
    - 이러한 부하 분산기는 api 게이트웨이에 내장
    - 디스커버리 서버에 등록된 인스턴스 목록을 가져옴
    - 라운드 로빈 방식
- 일대일 또는 일대다의 통신 분류
    - 일대일 상호작용
        - 유입되는 모든 요청이 정확하게 하나의 서비스 인스턴스에 의해 처리됨
    - 일대다 상호작용
        - 다수의 서비스 인스턴스에 의해 처리됨
- 동기 또는 비동기 방식으로 분류
- 리액티브 마이크로서비스
    - 스프링 5부터 지원
    - 몽고DB, 카산드라와 같은 데이터베이스와 리액티브 방식으로 통신을 지원하는 라이브러리 존재
- 게시-구독 (publish-subscribe)
    - 일대다 통신 타입
    - 클라이언트가 메시지를 발행하면 수신 대기 중인 모든 서비스에 의해 메시지가 소비됨
    - ex) Apache Kafka, RabbitMQ, ActiveMQ 같은 메시지 브로커로 구성
## 장애와 서킷 브레이커
- 장애에 대처하는 가장 좋은 방법은 응답을 기다릴 때 네트워크 타임아웃을 활용
- 한 서비스의 성능에 문제가 있으면 다른 서비스에 영향을 최소화하도록 노력해야 함
    - 장시간 응답을 기다리는 것 보다는 에러 응답이 나음
    
- 네트워크 타임아웃에 대한 해결책
    - 서킷 브레이커 패턴
        - 성공/실패 요청을 세 에러의 비율이 가정된 임계치를 넘으면 차단이 발생하고 이후 요청을 즉시 실패
        - 일정 시간 이후 API 요청을 다시해 성공하면 서킷을 닫아 정상화 됨
        - 한 인스턴스가 다른 것보다 느리게 동잗하면 부하 분산 처리 시 해당 인스턴스 무시           
    - 폴백
        - 요청이 실패했을 때 수행되는 로직
        - ex) 캐싱된 데이터, 기본값, 빈 결과 목록 반환
        - 저자는 에러코드를 전파하는 것을 선호

## 요약
- 스프링 클라우드의 가장 큰 장점은 모든 패턴과 메커니즘을 지원함
- 다른 프레임워크와 달리 안정적으로 구현됨
- 스프링 부트와 스프링 클라우드와 같은 프레임워크를 사용하면 클라우드 네이티브 개발을 가속할 수 있음
- 주의 사항
    - 클라우드 네이티브 개발로 이관하는 주요 동기는 품질은 유지하면서 애플리케이션의 구현 및 배포를 빠르게 하기 위함임
- 서비스는 작고 독립적이지만 중앙에서 관리됨
    - 네트워크 위치, 컨피규레이셔선, 로깅 파일, 메트릭과 같은 정보는 중앙에 저장돼야 함    